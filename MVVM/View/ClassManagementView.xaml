<UserControl x:Class="SchoolManager.MVVM.View.ClassManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:converters="clr-namespace:SchoolManager.Converters"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <ResourceDictionary>
            <converters:BooleanToStringConverter x:Key="BooleanToStringConverter"/>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Theme/ScrollBarTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <!-- Заголовок -->
        <TextBlock Grid.Row="0" Text="Управление классом и учащимися" 
                   FontSize="24" 
                   FontWeight="Bold"
                   Style="{StaticResource TextBlockTheme}" 
                   HorizontalAlignment="Center" 
                   VerticalAlignment="Top" 
                   Margin="0,20,0,10"/>
        <!-- Выбор класса -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="10">
            <TextBlock Text="Выберите класс:" 
                       FontSize="16"
                       Style="{StaticResource TextBlockTheme}" 
                       VerticalAlignment="Center" 
                       Margin="0,0,10,0"/>
            <ComboBox Width="100" 
                      ItemsSource="{Binding Classes}" 
                      SelectedValue="{Binding SelectedClass, UpdateSourceTrigger=PropertyChanged}"
                      SelectedValuePath="Name"
                      DisplayMemberPath="Name"
                      Style="{StaticResource ComboBoxTheme}"/>
        </StackPanel>
        <!-- Список учеников -->
        <ScrollViewer Grid.Row="2" 
                      VerticalScrollBarVisibility="Auto" 
                      Margin="10" 
                      CanContentScroll="True">
            <DataGrid ItemsSource="{Binding Students}" 
                      SelectedItem="{Binding SelectedStudent}"
                      AutoGenerateColumns="False" 
                      Background="Transparent"
                      RowHeight="40"
                      IsReadOnly="True"
                      HeadersVisibility="Column"
                      ColumnHeaderHeight="40"
                      BorderBrush="Transparent"
                      HorizontalGridLinesBrush="#808080"
                      VerticalGridLinesBrush="#808080"
                      ScrollViewer.CanContentScroll="False"
                      SelectionUnit="FullRow"
                      PreviewMouseWheel="DataGrid_PreviewMouseWheel">
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Background" Value="#5065A6"/>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#3B4A80"/>
                                <Setter Property="Foreground" Value="#808080"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="5"/>
                    </Style>
                </DataGrid.CellStyle>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Фамилия" Binding="{Binding LastName}" Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Имя" Binding="{Binding FirstName}" Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Отчество" Binding="{Binding MiddleName}" Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Класс" Binding="{Binding ClassName}" Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
        </ScrollViewer>
        <!-- Кнопки управления -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="10">
            <Button Content="Добавить" 
                    Command="{Binding OpenAddStudentPopupCommand}" 
                    Width="150" 
                    Height="40" 
                    Margin="0,0,10,0"
                    Style="{StaticResource LoginButtonTheme}"/>
            <Button Content="Редактировать" 
                    Command="{Binding OpenEditStudentPopupCommand}" 
                    Width="150" 
                    Height="40" 
                    Margin="0,0,10,0"
                    Style="{StaticResource LoginButtonTheme}"/>
            <Button Content="Удалить" 
                    Command="{Binding DeleteStudentCommand}" 
                    Width="150" 
                    Height="40"
                    Margin="0,0,10,0"
                    Style="{StaticResource LoginButtonTheme}"/>
            <Button Content="Перевод" 
                    Command="{Binding OpenTransferStudentPopupCommand}" 
                    Width="150" 
                    Height="40"
                    Style="{StaticResource LoginButtonTheme}"/>
        </StackPanel>
        <!-- Всплывающее окно -->
        <Popup IsOpen="{Binding IsPopupOpen}" 
               Placement="Center" 
               AllowsTransparency="True">
            <Border Background="#2F2F4F"
                    BorderBrush="#50508A"
                    BorderThickness="1" 
                    CornerRadius="10" 
                    Padding="20"
                    Width="350">
                <ScrollViewer VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Auto" 
                              CanContentScroll="True"
                              PreviewMouseWheel="PopupScrollViewer_PreviewMouseWheel">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" 
                                   Text="{Binding IsEditing, Converter={StaticResource BooleanToStringConverter}, ConverterParameter=Редактировать ученика|Добавить ученика}" 
                                   FontSize="18" 
                                   Style="{StaticResource TextBlockTheme}" 
                                   HorizontalAlignment="Center" 
                                   Margin="0,0,0,15"/>
                        <Grid Grid.Row="1" Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Фамилия:" 
                                       Style="{StaticResource TextBlockTheme}" 
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Left"
                                       Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding PopupLastName, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                     Style="{StaticResource PopupTextboxTheme}"/>
                        </Grid>
                        <Grid Grid.Row="2" Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Имя:" 
                                       Style="{StaticResource TextBlockTheme}" 
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Left"
                                       Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding PopupFirstName, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                     Style="{StaticResource PopupTextboxTheme}"/>
                        </Grid>
                        <Grid Grid.Row="3" Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Отчество:" 
                                       Style="{StaticResource TextBlockTheme}" 
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Left"
                                       Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" 
                                     Text="{Binding PopupPatronymic, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                     Style="{StaticResource PopupTextboxTheme}"/>
                        </Grid>
                        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,5">
                            <Button Content="Сохранить" 
                                    Command="{Binding SaveStudentCommand}" 
                                    Width="100" 
                                    Height="40" 
                                    Margin="0,0,10,0" 
                                    Style="{StaticResource LoginButtonTheme}"/>
                            <Button Content="Отменить" 
                                    Command="{Binding CancelPopupCommand}" 
                                    Width="100" 
                                    Height="40" 
                                    Style="{StaticResource LoginButtonTheme}"/>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </Border>
        </Popup>
        <!-- Всплывающее окно -->
        <Popup IsOpen="{Binding IsTransferPopupOpen}" 
               Placement="Center" 
               AllowsTransparency="True">
            <Border Background="#2F2F4F" 
                    BorderBrush="#50508A" 
                    BorderThickness="1" 
                    CornerRadius="10" 
                    Padding="20"
                    Width="350">
                <ScrollViewer VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Auto" 
                              CanContentScroll="True"
                              PreviewMouseWheel="PopupScrollViewer_PreviewMouseWheel">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" 
                                   Text="Перевод ученика" 
                                   FontSize="18" 
                                   Style="{StaticResource TextBlockTheme}" 
                                   HorizontalAlignment="Center" 
                                   Margin="0,0,0,15"/>
                        <Grid Grid.Row="1" Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Класс:" 
                                       Style="{StaticResource TextBlockTheme}" 
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Left"
                                       Margin="0,0,10,0"/>
                            <ComboBox Grid.Column="1" 
                                      ItemsSource="{Binding Classes}" 
                                      SelectedValue="{Binding SelectedNewClass, UpdateSourceTrigger=PropertyChanged}"
                                      SelectedValuePath="Name"
                                      DisplayMemberPath="Name"
                                      Style="{StaticResource ComboBoxTheme}"/>
                        </Grid>
                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,5">
                            <Button Content="Перевод" 
                                    Command="{Binding TransferStudentCommand}" 
                                    Width="100" 
                                    Height="40" 
                                    Margin="0,0,10,0" 
                                    Style="{StaticResource LoginButtonTheme}"/>
                            <Button Content="Отменить" 
                                    Command="{Binding CancelTransferPopupCommand}" 
                                    Width="100" 
                                    Height="40" 
                                    Style="{StaticResource LoginButtonTheme}"/>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </Border>
        </Popup>
    </Grid>
</UserControl>